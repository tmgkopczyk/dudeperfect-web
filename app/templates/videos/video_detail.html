{% extends "base.html" %}
{% block title %}{{ video.title }}{% endblock %}

{% block content %}
<section class="space-y-6">

  <!-- Back link -->
  <button
    type="button"
    onclick="if (history.length > 1) history.back(); else window.location='/'"
    class="text-sm text-neutral-500 hover:text-[#2EFCE6]"
  >
    ‚Üê Back
  </button>

  <!-- Title -->
  <header class="space-y-1">
    <h1 class="text-3xl font-semibold text-neutral-900">
      {{ video.title }}
    </h1>

    {% if video.youtube_video_id %}
      <a
        href="https://www.youtube.com/watch?v={{ video.youtube_video_id }}"
        target="_blank"
        class="text-sm text-[#2EFCE6] hover:underline"
      >
        Watch on YouTube ‚Üí
      </a>
    {% endif %}
  </header>

  {% if battle %}

  <hr>

  <!-- Players -->
  <section class="space-y-3">
    <h3 class="text-lg font-medium text-neutral-900">
      Players
    </h3>

    <ul class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">
      {% for team in battle.teams %}
        {% for player in team.players %}
          <li class="flex items-center gap-2 border rounded px-3 py-2 bg-white">
            {% if player.is_guest %}
              <span title="Guest">‚≠ê</span>
            {% endif %}
            {{ player.name }}
          </li>
        {% endfor %}
      {% endfor %}
    </ul>
  </section>

  {% if battle.description or battle.notes or battle.rules %}
  <hr>

  <!-- Battle Overview -->
  <section class="space-y-2">
    <h3 class="text-lg font-medium text-neutral-900">
      Battle Overview
    </h3>

    {% if battle.description %}
      <p class="text-sm text-neutral-700">
        {{ battle.description }}
      </p>
    {% endif %}

    {% if battle.rules %}
    <div class="text-sm text-neutral-700">
      <span class="font-semibold">Rules:</span>
        <div class="mt-1">
          {{ battle.rules }}
        </div>
    </div>
    {% endif %}


    {% if battle.notes %}
      <p class="text-sm text-neutral-600 italic">
        {{ battle.notes }}
      </p>
    {% endif %}
  </section>
  {% endif %}
  {% if battle.winner %}
  <div class="mt-4 flex items-center gap-2 rounded-lg border border-green-200 bg-green-50 px-4 py-3">
    <span class="text-lg">üèÜ</span>
    <span class="text-sm font-semibold text-green-700">
      Winner: {{ battle.winner }}
    </span>
  </div>
  {% endif %}


  {% if battle.timeline %}
  <hr>

  <section class="space-y-4">
    <h3 class="text-lg font-medium text-neutral-900">
      Battle Rounds
    </h3>

    {% for round in battle.timeline %}
      <div class="border rounded-lg p-4 space-y-3 bg-white">

        <div class="font-semibold text-neutral-800">
          {{ round.name }}
        </div>

        <ul class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">
          {% for p in round.results %}
          <li class="flex flex-col border rounded px-2 py-1 bg-white">

            <!-- Name + status -->
            <div class="flex justify-between items-center">
              <span class="font-medium">{{ p.name }}</span>

              {% if p.status %}
                <span class="text-xs italic
                  {% if p.status == 'winner' %}text-green-700
                  {% elif p.status == 'runner_up' %}text-blue-600
                  {% else %}text-neutral-500
                  {% endif %}">
                  {{ p.status | replace('_',' ') | title }}
                </span>
              {% endif %}
            </div>

            <!-- Score -->
            {% if p.score is defined and p.score is not none %}
              <div class="text-xs text-neutral-600">
                {{ p.score|round(2) }}
                {% if round.score_label %} {{ round.score_label }}{% endif %}
              </div>
            {% endif %}

            <!-- Notes -->
            {% if p.notes %}
              <div class="text-xs text-neutral-500 italic">
                {{ p.notes }}
              </div>
            {% endif %}

          </li>
          {% endfor %}

        </ul>

      </div>
    {% endfor %}
  </section>
  {% endif %}


  {% endif %}

  {% if overtime %}
  <hr>

  <section class="space-y-6">

    <h2 class="text-xl font-semibold text-neutral-900">
      Overtime {{ overtime.episode_number }} ‚Äî Cool Not Cool
    </h2>


    {% for item in overtime.items %}
    <div class="border rounded-lg p-4 bg-white space-y-3">

      <!-- Item header -->
      <div class="flex justify-between items-center">
        <div class="font-semibold text-neutral-800">
          <span class="text-neutral-500 text-sm">
            {{ item.presenter_name }}
          </span>
          <div class="text-lg">
            {{ item.item_name }}
          </div>
        </div>


        {% if item.overall %}
        <span class="text-sm px-2 py-1 rounded
          {% if item.overall == 'cool' %}
            bg-green-100 text-green-700
          {% elif item.overall == 'not_cool' %}
            bg-red-100 text-red-700
          {% else %}
            bg-neutral-200 text-neutral-700
          {% endif %}
        ">
          {{ item.overall | replace('_',' ') | title }}
        </span>
        {% endif %}
      </div>

      <!-- Votes grid -->
      <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">

        {% for vote in item.votes %}
        <div class="flex justify-between items-center border rounded px-2 py-1">

          <span>{{ vote.voter_name }}</span>

          <span class="
            {% if vote.vote == 'cool' %}
              text-green-600
            {% elif vote.vote == 'not_cool' %}
              text-red-600
            {% elif vote.vote == 'both' %}
              text-blue-600
            {% else %}
              text-neutral-500
            {% endif %}
          ">
            {{ vote.vote | replace('_',' ') | title }}
          </span>

        </div>
        {% endfor %}

      </div>

    </div>
    {% endfor %}

  </section>
  {% endif %}


  <hr class="border-neutral-300">

  <!-- Songs section -->
  <section class="space-y-3">
    <h2 class="text-xl font-medium text-neutral-900">
      Songs used
    </h2>

    {% if video.songs %}
      <ul class="space-y-3">
        {% for song in video.songs %}
          <li class="border border-gray-200 rounded p-3 hover:bg-gray-50">
            <a
              href="/songs/{{ song.id }}"
              class="font-semibold hover:text-[#2EFCE6]"
            >
              {{ song.title }}
            </a>

            {% if song.artists %}
              <div class="text-sm text-neutral-600">
                {{ song.artists | join(', ') }}
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-neutral-600 italic">
        No songs currently linked to this video.
      </p>
    {% endif %}
  </section>

</section>
{% endblock %}
