{% extends "base.html" %}
{% block title %}{{ video.title }}{% endblock %}

{% block content %}
<section class="space-y-6">

  <!-- Back link -->
  <button
    type="button"
    onclick="if (history.length > 1) history.back(); else window.location='/'"
    class="text-sm text-neutral-500 hover:text-[#2EFCE6]"
  >
    ‚Üê Back
  </button>

  <!-- Title -->
  <header class="space-y-1">
    <h1 class="text-3xl font-semibold text-neutral-900">
      {{ video.title }}
    </h1>

    {% if video.youtube_video_id %}
      <a
        href="https://www.youtube.com/watch?v={{ video.youtube_video_id }}"
        target="_blank"
        class="text-sm text-[#2EFCE6] hover:underline"
      >
        Watch on YouTube ‚Üí
      </a>
    {% endif %}
  </header>

  {% if battle %}
    <hr class="border-neutral-300">

    <!-- Battle section -->
    <section class="space-y-6">

      <!-- Battle meta -->
      <header class="space-y-1">
        <h2 class="text-2xl font-semibold text-neutral-900">
          Battle Overview
        </h2>

        <div class="text-sm text-neutral-600">
          {% set format_labels = {
  	    'elimination': 'Elimination',
            'round_robin': 'Round Robin',
            'points': 'Points-Based',
            'time_trial': 'Time Trial'
	  } %}

	  Format:
	  {{ format_labels.get(battle.format, battle.format | default('‚Äî') | replace('_', ' ') | title) }}
        </div>

        {% if battle.notes %}
          <p class="text-neutral-700">
            {{ battle.notes }}
          </p>
        {% endif %}
      </header>

      <!-- Players -->
      <section class="space-y-2">
        <h3 class="text-lg font-medium text-neutral-900">
          Players
        </h3>

        <div class="flex flex-wrap gap-2">
          {% for player in battle.players %}
            <span class="px-3 py-1 rounded bg-neutral-100 text-sm">
              {{ player.name }}
            </span>
          {% endfor %}
        </div>
      </section>

      <!-- Battle timeline -->
      <section class="space-y-4">
        <h3 class="text-lg font-medium text-neutral-900">
          Battle Timeline
        </h3>

        {% for event in battle.timeline %}
          <div class="border rounded-lg p-4 space-y-2">

            <div class="font-semibold text-neutral-800">
              {{ event.name }}
            </div>

            <ul class="space-y-1 text-sm">
              {% for result in event.results %}
                <li class="flex justify-between">
                  <span>{{ result.player }}</span>

                  <span class="text-neutral-600">
                    {% if result.status == 'winner' %}
                      üèÜ Winner
                    {% elif result.status == 'runner_up' %}
                      ü•à Runner-up
                    {% elif result.status == 'advanced' %}
                      Advanced
                    {% elif result.status == 'eliminated' %}
                      Eliminated
                    {% else %}
                      {{ result.status }}
                    {% endif %}
                  </span>
                </li>
              {% endfor %}
            </ul>

          </div>
        {% endfor %}
      </section>

      <!-- Final standings -->
      {% if battle.final_standings %}
        <section class="space-y-2">
          <h3 class="text-lg font-medium text-neutral-900">
            Final Standings
          </h3>

          <ol class="space-y-1 text-sm">
            {% for row in battle.final_standings %}
              <li>
                {{ row.rank }}. {{ row.name }}
              </li>
            {% endfor %}
          </ol>
        </section>
      {% endif %}

    </section>
  {% endif %}

  <hr class="border-neutral-300">

  <!-- Songs section -->
  <section class="space-y-3">
    <h2 class="text-xl font-medium text-neutral-900">
      Songs used
    </h2>

    {% if video.songs %}
      <ul class="space-y-3">
        {% for song in video.songs %}
          <li class="border border-gray-200 rounded p-3 hover:bg-gray-50">
            <a
              href="/songs/{{ song.id }}"
              class="font-semibold hover:text-[#2EFCE6]"
            >
              {{ song.title }}
            </a>

            {% if song.artists %}
              <div class="text-sm text-neutral-600">
                {{ song.artists | join(', ') }}
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-neutral-600 italic">
        No songs currently linked to this video.
      </p>
    {% endif %}
  </section>

</section>
{% endblock %}
